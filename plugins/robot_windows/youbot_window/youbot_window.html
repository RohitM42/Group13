<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Youbot 1.5</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 12px;
    }
    .row {
      margin-bottom: 8px;
    }
    label {
      display: inline-block;
      width: 70px;
    }
    input {
      width: 80px;
    }
    button {
      padding: 4px 10px;
      margin-top: 4px;
      margin-right: 4px;
    }
    #status {
      margin-top: 10px;
      font-size: 0.9em;
      color: #444;
      white-space: pre-line;
    }
    fieldset {
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <h2>Youbot 1.5</h2>

  <!-- Navigation block (same as before) -->
  <fieldset>
    <legend>Avoid obstacles</legend>
    <div class="row">
      <label for="x">X:</label>
      <input id="x" type="number" step="0.1" value="-1.0">
    </div>

    <div class="row">
      <label for="y">Y:</label>
      <input id="y" type="number" step="0.1" value="-0.5">
    </div>

    <div class="row">
      <label for="yaw">Yaw (deg):</label>
      <input id="yaw" type="number" step="5" value="0">
    </div>

    <button id="go">Plan &amp; Go</button>
  </fieldset>

  <!-- New: arm test controls -->
  <fieldset>
    <legend>Arm tests</legend>

    <div class="row">
      <button id="armReset">Arm reset</button>
      <button id="armPick">Pick pose</button>
      <button id="armHold">Hold pose</button>
      <button id="armDrop">Dropoff pose</button>
    </div>

    <div class="row">
      <button id="armHeightUp">Height +</button>
      <button id="armHeightDown">Height -</button>
    </div>

    <div class="row">
      <button id="armOrientLeft">Orientation -</button>
      <button id="armOrientRight">Orientation +</button>
    </div>
  </fieldset>

  <div id="status">JS loading…</div>

  <script type="module">
    import RobotWindow from 'https://cyberbotics.com/wwi/R2025a/RobotWindow.js';

    const robotWindow = new RobotWindow();
    window.robotWindow = robotWindow;
    robotWindow.setTitle('Youbot 1.5');

    const xInput    = document.getElementById('x');
    const yInput    = document.getElementById('y');
    const yawInput  = document.getElementById('yaw');
    const goBtn     = document.getElementById('go');

    const statusEl  = document.getElementById('status');

    // Arm buttons
    const armResetBtn      = document.getElementById('armReset');
    const armPickBtn       = document.getElementById('armPick');
    const armHoldBtn       = document.getElementById('armHold');
    const armDropBtn       = document.getElementById('armDrop');
    const armHeightUpBtn   = document.getElementById('armHeightUp');
    const armHeightDownBtn = document.getElementById('armHeightDown');
    const armOrientLeftBtn = document.getElementById('armOrientLeft');
    const armOrientRightBtn= document.getElementById('armOrientRight');

    function setStatus(text) {
      statusEl.textContent = text;
      console.log('[STATUS]', text);
    }

    function sendMessage(msg) {
      console.log('[WINDOW] sending:', msg);
      robotWindow.send(msg);
      setStatus(msg + '\n' + 'time=' + new Date().toLocaleTimeString());
    }

    // Navigation button
    goBtn.addEventListener('click', () => {
      const x      = parseFloat(xInput.value);
      const y      = parseFloat(yInput.value);
      const yawDeg = parseFloat(yawInput.value);

      if (Number.isNaN(x) || Number.isNaN(y) || Number.isNaN(yawDeg)) {
        setStatus('Invalid input');
        return;
      }

      const yawRad = yawDeg * Math.PI / 180.0;
      const msg = `NAV_GOTO ${x} ${y} ${yawRad}`;
      sendMessage(msg);
    });

    // Arm commands
    armResetBtn.addEventListener('click', () => {
      sendMessage('ARM_RESET');
    });

    armPickBtn.addEventListener('click', () => {
      sendMessage('ARM_PICK');
    });

    armHoldBtn.addEventListener('click', () => {
      sendMessage('ARM_HOLD');
    });

    armDropBtn.addEventListener('click', () => {
      sendMessage('ARM_DROPOFF');
    });

    armHeightUpBtn.addEventListener('click', () => {
      sendMessage('ARM_HEIGHT_UP');
    });

    armHeightDownBtn.addEventListener('click', () => {
      sendMessage('ARM_HEIGHT_DOWN');
    });

    armOrientLeftBtn.addEventListener('click', () => {
      sendMessage('ARM_ORIENT_DEC');
    });

    armOrientRightBtn.addEventListener('click', () => {
      sendMessage('ARM_ORIENT_INC');
    });

    // Messages from controller (optional)
    robotWindow.receive = (message, robot) => {
      console.log('[WINDOW] From controller:', message, 'for robot:', robot);
      setStatus('From controller: ' + message + '\n' +
                'time=' + new Date().toLocaleTimeString());
    };

    setStatus('JS loaded – ready');
  </script>
</body>
</html>

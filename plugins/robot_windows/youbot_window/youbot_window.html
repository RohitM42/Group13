<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Youbot GOTO 1.0</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 12px;
    }
    .row {
      margin-bottom: 8px;
    }
    label {
      display: inline-block;
      width: 70px;
    }
    input {
      width: 80px;
    }
    button {
      padding: 4px 10px;
      margin-top: 8px;
    }
    #status {
      margin-top: 10px;
      font-size: 0.9em;
      color: #444;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h2>Youbot GOTO 1.0</h2>

  <div class="row">
    <label for="x">X:</label>
    <input id="x" type="number" step="0.1" value="-1.0">
  </div>

  <div class="row">
    <label for="y">Y:</label>
    <input id="y" type="number" step="0.1" value="-0.5">
  </div>

  <div class="row">
    <label for="yaw">Yaw (deg):</label>
    <input id="yaw" type="number" step="5" value="0">
  </div>

  <button id="go">Go</button>

  <div id="status">JS loadingâ€¦</div>

  <!-- IMPORTANT: this script is an ES module, like generic.js -->
  <script type="module">
    import RobotWindow from 'https://cyberbotics.com/wwi/R2025a/RobotWindow.js';

    // Create robot window bound to the robot shown in ?name=youBot
    const robotWindow = new RobotWindow();
    // Expose it globally just for debugging if you want to poke in console
    window.robotWindow = robotWindow;

    robotWindow.setTitle('Youbot GOTO 1.0');

    const xInput   = document.getElementById('x');
    const yInput   = document.getElementById('y');
    const yawInput = document.getElementById('yaw');
    const goBtn    = document.getElementById('go');
    const statusEl = document.getElementById('status');

    function setStatus(text) {
      statusEl.textContent = text;
      console.log('[STATUS]', text);
    }

    setStatus('JS loaded, RobotWindow created, waiting for click');

    goBtn.addEventListener('click', () => {
      const x      = parseFloat(xInput.value);
      const y      = parseFloat(yInput.value);
      const yawDeg = parseFloat(yawInput.value);

      if (Number.isNaN(x) || Number.isNaN(y) || Number.isNaN(yawDeg)) {
        setStatus('Invalid input');
        return;
      }

      const yawRad = yawDeg * Math.PI / 180.0;
      const msg = `GOTO ${x} ${y} ${yawRad}`;

      console.log('[WINDOW] GO CLICKED, msg =', msg);
      setStatus(
        'GO CLICKED!\n' +
        'msg=' + msg + '\n' +
        'time=' + new Date().toLocaleTimeString()
      );

      robotWindow.send(msg);
    });

    // Optional: handle messages FROM controller, if you ever send any
    robotWindow.receive = (message, robot) => {
      console.log('[WINDOW] From controller:', message, 'for robot:', robot);
      setStatus(
        'From controller: ' + message + '\n' +
        'time=' + new Date().toLocaleTimeString()
      );
    };
  </script>
</body>
</html>
